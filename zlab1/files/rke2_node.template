#!/bin/bash -x

PUBLIC_IP=`curl -s -H Metadata:true --noproxy "*" "http://169.254.169.254/metadata/instance/network?api-version=2017-08-01" | jq -r '.interface[0].ipv4.ipAddress[].publicIpAddress'`
PRIVATE_IP=`curl -s -H Metadata:true --noproxy "*" "http://169.254.169.254/metadata/instance/network?api-version=2017-08-01" | jq -r '.interface[0].ipv4.ipAddress[].privateIpAddress'`

${register_command} --address $PUBLIC_IP --internal-address $PRIVATE_IP --etcd --controlplane --worker
